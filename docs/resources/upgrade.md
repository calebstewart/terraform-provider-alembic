---
page_title: "alembic_upgrade Resource - terraform-provider-alembic"
subcategory: ""
description: |-
  Upgrade a database to the specified revision ID or 'head'
---

# alembic_upgrade (Resource)

Upgrade a database to the specified revision ID or 'head'

## Example Usage

```terraform
# Upgrade a database
resource "alembic_upgrade" "db-upgrade" {
  target = "head"          // The revision ID or special "head" value
  tag    = "my-custom-tag" // Custom tag passed with the --tag option

  // Environment variables passed to the alembic command
  environment = {
    DATABASE_URL = locals.database_connection_string
  }

  // These are passed **along with** any extras defined at the provider
  // level using the -x argument to Alembic.
  // extra = {
  //   something = "special"
  // }

  // You can override the alembic command on a per-resource basis
  // alembic = ["custom", "alembic", "command"]

  // If you need a proxy like cloudsql or an SSH port forward for connecting,
  // you can do that here.
  // proxy_command = ["cloud_sql_proxy", "-instances=..."]

  // You can also set a sleep duration for after starting the proxy.
  // This is set to 5s by default, and will happen whenever a connection
  // needs to be made to the database.
  // proxy_sleep = "30s"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `target` (String) Revision identifier. The target revision to which we will upgrade.

### Optional

- `alembic` (List of String) Command used to execute alembic. By default, this is taken from the provider configuration.
- `environment` (Map of String, Sensitive) Environment variables to set when running the alembic command.
- `extra` (Map of String) Additional arguments consumed by custom env.py scripts
- `proxy_command` (List of String) An argument list used to execute a proxy which allows direct communication with the database (e.g. cloud-sql-proxy)
- `proxy_sleep` (String) Amount of time to sleep in order to allow the proxy to startup. Format is '[0-9]+(s|m|h|d|M|Y)' (default: '5s')
- `tag` (String) Arbitrary 'tag' name - can be used by custom env.py scripts.

### Read-Only

- `id` (String) A unique ID for this resource used internally by terraform. Not intended for external use.
- `revision` (String) The resulting revision after applying the upgrade.

## Note on Resource Deletion

The concept of deleting an Alembic upgrade/stamp operation does not make
much sense. If the expectation were to remove all Alembic revisions, that
would be the equivalent of rebuilding the database. In that case, you
should instead taint the database resource itself to trigger recreation.

Both the `alembic_upgrade` and `alembic_stamp` resources have NOOPs
implemented for their deletion routines. However, because Alembic is
stateful and can recognize when a revision is already applied, this
should not affect recreation.

## Note on Proxy Commands

Both the `alembic_upgrade` and `alembic_stamp` resources provide an optional
attribute named `proxy_command` which is an argument list to be executed
for the duration of your Alembic execution. The intent is to start some
form of proxy needed to access your database server directly. In the case
of Google Cloud Platform deployments, this is commonly `cloud_sql_proxy`,
but could be anything that proxies traffic to your database instance. For
example, it could be an SSH command to tunnel traffic to an internal instance.

Because this is a free-form argument list for a process, there are a few
things worth noting:

1. Obviously, this allows execution of arbitrary other binaries through
   your terraform configuration. Care should be taken with what you
   execute through this configuration.
2. There is another optional configuration named `proxy_sleep` which
   controls how long the provider should sleep after invoking the proxy
   command before attempting to execute Alembic commands. This is because
   the proxy may not be up immediately, and attempting to start Alembic
   quickly normally results in connection timeouts. The default value
   of this configuration is `5s` which will cause each operation
   (Read, Update, Create, etc) to sleep for 5 seconds before starting
   execution.
3. The third-party command must obvioulsy be installed on the system
   running terraform. In the case of `cloud_sql_proxy`, that requires
   you to go and download the static binary provided by Google, and
   placing it either in your `PATH` or providing the fully qualified
   path as the first element in your `proxy_command` array.
